"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/line-webhook/route";
exports.ids = ["app/api/line-webhook/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "node:process":
/*!*******************************!*\
  !*** external "node:process" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("node:process");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fline-webhook%2Froute&page=%2Fapi%2Fline-webhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fline-webhook%2Froute.ts&appDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fline-webhook%2Froute&page=%2Fapi%2Fline-webhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fline-webhook%2Froute.ts&appDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_fame_non_project_line_bot_mcp_server_ui_next_app_api_line_webhook_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/line-webhook/route.ts */ \"(rsc)/./app/api/line-webhook/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/line-webhook/route\",\n        pathname: \"/api/line-webhook\",\n        filename: \"route\",\n        bundlePath: \"app/api/line-webhook/route\"\n    },\n    resolvedPagePath: \"D:\\\\fame\\\\non-project\\\\line-bot-mcp-server\\\\ui-next\\\\app\\\\api\\\\line-webhook\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_fame_non_project_line_bot_mcp_server_ui_next_app_api_line_webhook_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/line-webhook/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZsaW5lLXdlYmhvb2slMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmxpbmUtd2ViaG9vayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmxpbmUtd2ViaG9vayUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDZmFtZSU1Q25vbi1wcm9qZWN0JTVDbGluZS1ib3QtbWNwLXNlcnZlciU1Q3VpLW5leHQlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNmYW1lJTVDbm9uLXByb2plY3QlNUNsaW5lLWJvdC1tY3Atc2VydmVyJTVDdWktbmV4dCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD1zdGFuZGFsb25lJnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3FDO0FBQ2xIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbGluZS1ib3QtbWNwLXVpLz8yMTZjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXGZhbWVcXFxcbm9uLXByb2plY3RcXFxcbGluZS1ib3QtbWNwLXNlcnZlclxcXFx1aS1uZXh0XFxcXGFwcFxcXFxhcGlcXFxcbGluZS13ZWJob29rXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcInN0YW5kYWxvbmVcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbGluZS13ZWJob29rL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvbGluZS13ZWJob29rXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9saW5lLXdlYmhvb2svcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxmYW1lXFxcXG5vbi1wcm9qZWN0XFxcXGxpbmUtYm90LW1jcC1zZXJ2ZXJcXFxcdWktbmV4dFxcXFxhcHBcXFxcYXBpXFxcXGxpbmUtd2ViaG9va1xcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvbGluZS13ZWJob29rL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fline-webhook%2Froute&page=%2Fapi%2Fline-webhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fline-webhook%2Froute.ts&appDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/line-webhook/route.ts":
/*!***************************************!*\
  !*** ./app/api/line-webhook/route.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _modelcontextprotocol_sdk_client_index_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @modelcontextprotocol/sdk/client/index.js */ \"(rsc)/../node_modules/@modelcontextprotocol/sdk/dist/esm/client/index.js\");\n/* harmony import */ var _modelcontextprotocol_sdk_client_stdio_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @modelcontextprotocol/sdk/client/stdio.js */ \"(rsc)/../node_modules/@modelcontextprotocol/sdk/dist/esm/client/stdio.js\");\n/* harmony import */ var _lib_stats__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../lib/stats */ \"(rsc)/./lib/stats.ts\");\nconst runtime = \"nodejs\";\nconst dynamic = \"force-dynamic\";\n\n\n\n\n\n\nfunction loadParentEnvOnce() {\n    try {\n        const loadedFlag = globalThis.__parentEnvLoaded;\n        if (loadedFlag) return;\n        const parentEnv = path__WEBPACK_IMPORTED_MODULE_2___default().resolve(process.cwd(), \"..\", \".env\");\n        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(parentEnv)) {\n            const text = fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(parentEnv, \"utf8\");\n            for (const line of text.split(/\\r?\\n/)){\n                if (!line || line.trim().startsWith(\"#\")) continue;\n                const idx = line.indexOf(\"=\");\n                if (idx <= 0) continue;\n                const key = line.slice(0, idx).trim();\n                let val = line.slice(idx + 1).trim();\n                if (val.startsWith('\"') && val.endsWith('\"') || val.startsWith(\"'\") && val.endsWith(\"'\")) {\n                    val = val.slice(1, -1);\n                }\n                if (!process.env[key]) process.env[key] = val;\n            }\n        }\n        globalThis.__parentEnvLoaded = true;\n    } catch  {\n    // ignore\n    }\n}\nloadParentEnvOnce();\nasync function getClient() {\n    if (globalThis.__mcpClientWebhook) return globalThis.__mcpClientWebhook;\n    const projectRoot = path__WEBPACK_IMPORTED_MODULE_2___default().resolve(process.cwd(), \"..\");\n    const transport = new _modelcontextprotocol_sdk_client_stdio_js__WEBPACK_IMPORTED_MODULE_4__.StdioClientTransport({\n        command: \"node\",\n        args: [\n            \"dist/index.js\"\n        ],\n        cwd: projectRoot,\n        env: process.env\n    });\n    const client = new _modelcontextprotocol_sdk_client_index_js__WEBPACK_IMPORTED_MODULE_3__.Client({\n        name: \"line-bot-webhook\",\n        version: \"0.1.0\"\n    });\n    await client.connect(transport);\n    globalThis.__mcpClientWebhook = client;\n    (0,_lib_stats__WEBPACK_IMPORTED_MODULE_5__.updateStats)({\n        mcpConnected: true,\n        lineWebhookActive: true\n    });\n    return client;\n}\nfunction verifyLineSignature(rawBody, signature) {\n    try {\n        const secret = process.env.CHANNEL_SECRET || \"\";\n        if (!secret || !signature) return false;\n        const hmac = crypto__WEBPACK_IMPORTED_MODULE_0___default().createHmac(\"sha256\", secret);\n        hmac.update(rawBody);\n        const digest = hmac.digest(\"base64\");\n        return crypto__WEBPACK_IMPORTED_MODULE_0___default().timingSafeEqual(Buffer.from(digest), Buffer.from(signature));\n    } catch  {\n        return false;\n    }\n}\nasync function POST(req) {\n    try {\n        const signature = req.headers.get(\"x-line-signature\");\n        const raw = await req.text();\n        const disableVerify = String(process.env.DISABLE_LINE_SIGNATURE_VERIFY || \"\").toLowerCase() === \"true\";\n        if (!disableVerify && !verifyLineSignature(raw, signature)) {\n            try {\n                (0,_lib_stats__WEBPACK_IMPORTED_MODULE_5__.addEvent)({\n                    type: \"http\",\n                    ok: false,\n                    message: \"POST /api/line-webhook 401\"\n                });\n            } catch  {}\n            return new Response(JSON.stringify({\n                error: \"invalid signature\"\n            }), {\n                status: 401,\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n        }\n        const body = JSON.parse(raw);\n        const events = Array.isArray(body?.events) ? body.events : [];\n        const client = await getClient();\n        (0,_lib_stats__WEBPACK_IMPORTED_MODULE_5__.updateStats)({\n            lineWebhookActive: true\n        });\n        if (!globalThis.__userPrefs) globalThis.__userPrefs = new Map();\n        const prefs = globalThis.__userPrefs;\n        for (const ev of events){\n            const userId = ev?.source?.userId || \"\";\n            if (ev?.type === \"message\" && ev?.message?.type === \"text\") {\n                let text = ev.message.text || \"\";\n                const dest = userId || process.env.DESTINATION_USER_ID || \"\";\n                let t = text.toLowerCase();\n                if (t.includes(\"login db\")) {\n                    if (userId) prefs.set(userId, {\n                        knowledgeSource: \"mssql\"\n                    });\n                    try {\n                        await client.callTool({\n                            name: \"push_text_message\",\n                            arguments: {\n                                userId,\n                                message: {\n                                    type: \"text\",\n                                    text: \"เชื่อมต่อฐานข้อมูล (MSSQL) สำหรับโหมดถาม/ตอบแล้ว\"\n                                }\n                            }\n                        });\n                    } catch  {}\n                    continue;\n                }\n                if (t.includes(\"logout db\")) {\n                    if (userId) prefs.set(userId, {\n                        knowledgeSource: \"file\"\n                    });\n                    try {\n                        await client.callTool({\n                            name: \"push_text_message\",\n                            arguments: {\n                                userId,\n                                message: {\n                                    type: \"text\",\n                                    text: \"ยกเลิกโหมดฐานข้อมูล ใช้ไฟล์ความรู้แทน\"\n                                }\n                            }\n                        });\n                    } catch  {}\n                    continue;\n                }\n                const pref = userId && prefs.get(userId) || {\n                    knowledgeSource: \"file\"\n                };\n                const knowledgeSource = pref.knowledgeSource;\n                // Heuristic: remember explicit table mentions and support pronoun \"ตารางนี้/table นี้/this table\"\n                const explicitTableMatch = t.match(/(?:table|จาก|เข้าไป|ไป|from)\\s+([a-z0-9_\\.]+)/i);\n                if (explicitTableMatch && explicitTableMatch[1] && userId) {\n                    const raw = explicitTableMatch[1];\n                    const full = raw.includes(\".\") ? raw : `dbo.${raw}`;\n                    prefs.set(userId, {\n                        ...pref,\n                        lastTable: full\n                    });\n                }\n                if (/(ตารางนี้|table\\s*นี้|this\\s*table)/i.test(text) && pref.lastTable) {\n                    text = text.replace(/ตารางนี้|table\\s*นี้|this\\s*table/gi, pref.lastTable);\n                    t = text.toLowerCase();\n                }\n                if (knowledgeSource === \"mssql\" && /(ทั้งหมดกี่รายการ|มีกี่รายการ|count\\s*(all)?)/i.test(text)) {\n                    if (pref.lastTable) {\n                        try {\n                            const q = await client.callTool({\n                                name: \"query_mssql\",\n                                arguments: {\n                                    sql: `SELECT COUNT(1) AS total_count FROM ${pref.lastTable}`,\n                                    limit: 1\n                                }\n                            });\n                            const parsed = JSON.parse(q.content?.[0]?.text || \"{}\");\n                            const rows = Array.isArray(parsed?.rows) ? parsed.rows : [];\n                            const cnt = rows[0]?.total_count ?? pref.lastRowCount ?? 0;\n                            const msg = `ทั้งหมด ${cnt} รายการ (จาก ${pref.lastTable})`;\n                            await client.callTool({\n                                name: \"push_text_message\",\n                                arguments: {\n                                    userId: dest,\n                                    message: {\n                                        type: \"text\",\n                                        text: msg\n                                    }\n                                }\n                            });\n                            continue;\n                        } catch  {\n                        // ignore and fall through\n                        }\n                    }\n                }\n                // 2) Ask which table?\n                if (knowledgeSource === \"mssql\" && /(จากตารางไหน|what\\s*table)/i.test(text)) {\n                    const msg = pref.lastTable ? `จากตาราง ${pref.lastTable}` : \"ยังไม่ทราบตาราง (โปรดระบุ)\";\n                    try {\n                        await client.callTool({\n                            name: \"push_text_message\",\n                            arguments: {\n                                userId: dest,\n                                message: {\n                                    type: \"text\",\n                                    text: msg\n                                }\n                            }\n                        });\n                        continue;\n                    } catch  {}\n                }\n                // If user asks for all tables summary\n                if (knowledgeSource === \"mssql\" && /(แสดงข้อมูล.*ตาราง.*ทั้งหมด|แสดงข้อมูลแต่ละ\\s*ตาราง|ทุก\\s*ตาราง)/i.test(text)) {\n                    try {\n                        // Use MCP tool query_mssql to fetch table list\n                        const q = await client.callTool({\n                            name: \"query_mssql\",\n                            arguments: {\n                                sql: \"SELECT TOP 50 s.name AS schema_name, t.name AS table_name FROM sys.tables t JOIN sys.schemas s ON t.schema_id = s.schema_id WHERE t.is_ms_shipped = 0 ORDER BY s.name, t.name\",\n                                limit: 50\n                            }\n                        });\n                        const parsed = JSON.parse(q.content?.[0]?.text || \"{}\");\n                        const rows = Array.isArray(parsed?.rows) ? parsed.rows : [];\n                        const out = rows.map((r)=>`- ${r.schema_name}.${r.table_name}`).slice(0, 50).join(\"\\n\");\n                        const textMsg = out || \"(ไม่พบตาราง)\";\n                        await client.callTool({\n                            name: \"push_text_message\",\n                            arguments: {\n                                userId,\n                                message: {\n                                    type: \"text\",\n                                    text: textMsg\n                                }\n                            }\n                        });\n                        continue;\n                    } catch  {}\n                }\n                // If user says \"แสดงมา/โชว์หน่อย/เอามา\" and we have lastTable (+ optional lastLimit)\n                if (knowledgeSource === \"mssql\" && /(แสดงมา|โชว์หน่อย|เอามา)/i.test(text) && pref.lastTable) {\n                    const lim = pref.lastLimit && pref.lastLimit > 0 ? pref.lastLimit : 10;\n                    text = `เข้าไป ${pref.lastTable} แสดง${lim} ข้อมูล`;\n                    t = text.toLowerCase();\n                }\n                // If user says \"แสดง {N} (รายการ|แถว)\" and we have lastTable, rewrite\n                const mShowN = t.match(/แสดง(?:ข้อมูล)?\\s*(\\d{1,4})\\s*(?:รายการ|แถว)?/i);\n                if (knowledgeSource === \"mssql\" && mShowN && pref.lastTable) {\n                    const lim = parseInt(mShowN[1], 10);\n                    text = `เข้าไป ${pref.lastTable} แสดง${lim} ข้อมูล`;\n                    prefs.set(userId, {\n                        ...pref,\n                        lastLimit: lim\n                    });\n                }\n                // Try AI-driven SQL first when using DB knowledge\n                if (knowledgeSource === \"mssql\") {\n                    try {\n                        const q = await client.callTool({\n                            name: \"ai_query_mssql\",\n                            arguments: {\n                                instruction: text,\n                                maxRows: 10,\n                                allowedTables: pref.lastTable ? [\n                                    pref.lastTable\n                                ] : undefined\n                            }\n                        });\n                        const raw = q?.content?.[0]?.text || \"\";\n                        try {\n                            const payload = raw ? JSON.parse(raw) : null;\n                            if (payload && Array.isArray(payload.rows)) {\n                                const rows = payload.rows;\n                                const cols = Array.isArray(payload.columns) ? payload.columns : rows[0] ? Object.keys(rows[0]) : [];\n                                const previewCols = cols.slice(0, 3);\n                                const head = `ผลลัพธ์ ${Math.min(rows.length, 10)} / ${payload.rowCount ?? rows.length} แถว`;\n                                const body = rows.slice(0, 10).map((r, i)=>`${i + 1}. ${previewCols.map((c)=>`${c}: ${String(r[c] ?? \"\")}`).join(\", \")}`).join(\"\\n\");\n                                const txt = [\n                                    head,\n                                    body\n                                ].filter(Boolean).join(\"\\n\").slice(0, 2000);\n                                await client.callTool({\n                                    name: \"push_text_message\",\n                                    arguments: {\n                                        userId: dest,\n                                        message: {\n                                            type: \"text\",\n                                            text: txt\n                                        }\n                                    }\n                                });\n                                // Try to extract table name from SQL and store context\n                                try {\n                                    const sql = String(payload.sql || \"\");\n                                    const mFrom = sql.match(/from\\s+([a-z0-9_\\.]+)/i);\n                                    const tbl = mFrom && mFrom[1] ? mFrom[1] : pref.lastTable;\n                                    const newPref = {\n                                        ...pref,\n                                        lastTable: tbl,\n                                        lastLimit: 10,\n                                        lastRowCount: payload.rowCount ?? rows.length\n                                    };\n                                    if (userId) prefs.set(userId, newPref);\n                                } catch  {}\n                                continue;\n                            }\n                        } catch  {\n                        // parsing failed; fall back below\n                        }\n                    } catch  {\n                    // ai_query_mssql failed; fall back below\n                    }\n                }\n                const args = {\n                    instruction: text,\n                    model: \"gemini-2.0-flash\",\n                    mode: \"auto\",\n                    userId: dest,\n                    knowledgeSource\n                };\n                if (knowledgeSource === \"file\") {\n                    const defaultKnowledge = process.env.DEFAULT_KNOWLEDGE_FILE || \"docs/data-learning/knowledge.md\";\n                    args.filePath = defaultKnowledge;\n                }\n                try {\n                    await client.callTool({\n                        name: \"gemini_command\",\n                        arguments: args\n                    });\n                } catch (e) {\n                // swallow to not break webhook pipeline\n                }\n            }\n        }\n        try {\n            (0,_lib_stats__WEBPACK_IMPORTED_MODULE_5__.addEvent)({\n                type: \"http\",\n                ok: true,\n                message: \"POST /api/line-webhook 200\"\n            });\n        } catch  {}\n        return new Response(JSON.stringify({\n            ok: true\n        }), {\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n    } catch (e) {\n        try {\n            (0,_lib_stats__WEBPACK_IMPORTED_MODULE_5__.addEvent)({\n                type: \"http\",\n                ok: false,\n                message: \"POST /api/line-webhook 500\"\n            });\n        } catch  {}\n        return new Response(JSON.stringify({\n            error: e?.message || String(e)\n        }), {\n            status: 500,\n            headers: {\n                \"Content-Type\": \"application/json\"\n            }\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFDaEQ7SUFDRixFQUFFLE9BQU8wRixHQUFRO1FBQ2YsSUFBSTtZQUFFM0ksb0RBQVFBLENBQUM7Z0JBQUV3RCxNQUFNO2dCQUFRQyxJQUFJO2dCQUFPQyxTQUFTO1lBQTZCO1FBQUksRUFBRSxPQUFNLENBQUM7UUFDN0YsT0FBTyxJQUFJQyxTQUFTQyxLQUFLQyxTQUFTLENBQUM7WUFBRUMsT0FBTzZFLEdBQUdqRixXQUFXTCxPQUFPc0Y7UUFBRyxJQUFJO1lBQ3RFNUUsUUFBUTtZQUNSZCxTQUFTO2dCQUFFLGdCQUFnQjtZQUFtQjtRQUNoRDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9saW5lLWJvdC1tY3AtdWkvLi9hcHAvYXBpL2xpbmUtd2ViaG9vay9yb3V0ZS50cz8yMzA1Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBydW50aW1lID0gXCJub2RlanNcIjtcbmV4cG9ydCBjb25zdCBkeW5hbWljID0gXCJmb3JjZS1keW5hbWljXCI7XG5cbmltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IENsaWVudCB9IGZyb20gXCJAbW9kZWxjb250ZXh0cHJvdG9jb2wvc2RrL2NsaWVudC9pbmRleC5qc1wiO1xuaW1wb3J0IHsgU3RkaW9DbGllbnRUcmFuc3BvcnQgfSBmcm9tIFwiQG1vZGVsY29udGV4dHByb3RvY29sL3Nkay9jbGllbnQvc3RkaW8uanNcIjtcbmltcG9ydCB7IHVwZGF0ZVN0YXRzLCBhZGRFdmVudCB9IGZyb20gXCIuLi8uLi8uLi9saWIvc3RhdHNcIjtcblxuZGVjbGFyZSBnbG9iYWwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG4gIHZhciBfX21jcENsaWVudFdlYmhvb2s6IENsaWVudCB8IHVuZGVmaW5lZDtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgX191c2VyUHJlZnM6XG4gICAgfCBNYXA8XG4gICAgICAgIHN0cmluZyxcbiAgICAgICAge1xuICAgICAgICAgIGtub3dsZWRnZVNvdXJjZTogXCJmaWxlXCIgfCBcIm1zc3FsXCI7XG4gICAgICAgICAgbGFzdFRhYmxlPzogc3RyaW5nO1xuICAgICAgICAgIGxhc3RMaW1pdD86IG51bWJlcjtcbiAgICAgICAgICBsYXN0Um93Q291bnQ/OiBudW1iZXI7XG4gICAgICAgIH1cbiAgICAgID5cbiAgICB8IHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gbG9hZFBhcmVudEVudk9uY2UoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgbG9hZGVkRmxhZyA9IChnbG9iYWxUaGlzIGFzIGFueSkuX19wYXJlbnRFbnZMb2FkZWQ7XG4gICAgaWYgKGxvYWRlZEZsYWcpIHJldHVybjtcbiAgICBjb25zdCBwYXJlbnRFbnYgPSBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSwgXCIuLlwiLCBcIi5lbnZcIik7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMocGFyZW50RW52KSkge1xuICAgICAgY29uc3QgdGV4dCA9IGZzLnJlYWRGaWxlU3luYyhwYXJlbnRFbnYsIFwidXRmOFwiKTtcbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiB0ZXh0LnNwbGl0KC9cXHI/XFxuLykpIHtcbiAgICAgICAgaWYgKCFsaW5lIHx8IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoXCIjXCIpKSBjb250aW51ZTtcbiAgICAgICAgY29uc3QgaWR4ID0gbGluZS5pbmRleE9mKFwiPVwiKTtcbiAgICAgICAgaWYgKGlkeCA8PSAwKSBjb250aW51ZTtcbiAgICAgICAgY29uc3Qga2V5ID0gbGluZS5zbGljZSgwLCBpZHgpLnRyaW0oKTtcbiAgICAgICAgbGV0IHZhbCA9IGxpbmUuc2xpY2UoaWR4ICsgMSkudHJpbSgpO1xuICAgICAgICBpZiAoKHZhbC5zdGFydHNXaXRoKCdcIicpICYmIHZhbC5lbmRzV2l0aCgnXCInKSkgfHwgKHZhbC5zdGFydHNXaXRoKFwiJ1wiKSAmJiB2YWwuZW5kc1dpdGgoXCInXCIpKSkge1xuICAgICAgICAgIHZhbCA9IHZhbC5zbGljZSgxLCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFwcm9jZXNzLmVudltrZXldKSBwcm9jZXNzLmVudltrZXldID0gdmFsO1xuICAgICAgfVxuICAgIH1cbiAgICAoZ2xvYmFsVGhpcyBhcyBhbnkpLl9fcGFyZW50RW52TG9hZGVkID0gdHJ1ZTtcbiAgfSBjYXRjaCB7XG4gICAgLy8gaWdub3JlXG4gIH1cbn1cbmxvYWRQYXJlbnRFbnZPbmNlKCk7XG5cbmFzeW5jIGZ1bmN0aW9uIGdldENsaWVudCgpOiBQcm9taXNlPENsaWVudD4ge1xuICBpZiAoZ2xvYmFsVGhpcy5fX21jcENsaWVudFdlYmhvb2spIHJldHVybiBnbG9iYWxUaGlzLl9fbWNwQ2xpZW50V2ViaG9vaztcblxuICBjb25zdCBwcm9qZWN0Um9vdCA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBcIi4uXCIpO1xuICBjb25zdCB0cmFuc3BvcnQgPSBuZXcgU3RkaW9DbGllbnRUcmFuc3BvcnQoe1xuICAgIGNvbW1hbmQ6IFwibm9kZVwiLFxuICAgIGFyZ3M6IFtcImRpc3QvaW5kZXguanNcIl0sXG4gICAgY3dkOiBwcm9qZWN0Um9vdCxcbiAgICBlbnY6IHByb2Nlc3MuZW52IGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZz4sXG4gIH0pO1xuICBjb25zdCBjbGllbnQgPSBuZXcgQ2xpZW50KHsgbmFtZTogXCJsaW5lLWJvdC13ZWJob29rXCIsIHZlcnNpb246IFwiMC4xLjBcIiB9KTtcbiAgYXdhaXQgY2xpZW50LmNvbm5lY3QodHJhbnNwb3J0KTtcbiAgZ2xvYmFsVGhpcy5fX21jcENsaWVudFdlYmhvb2sgPSBjbGllbnQ7XG4gIHVwZGF0ZVN0YXRzKHsgbWNwQ29ubmVjdGVkOiB0cnVlLCBsaW5lV2ViaG9va0FjdGl2ZTogdHJ1ZSB9KTtcbiAgcmV0dXJuIGNsaWVudDtcbn1cblxuZnVuY3Rpb24gdmVyaWZ5TGluZVNpZ25hdHVyZShyYXdCb2R5OiBzdHJpbmcsIHNpZ25hdHVyZTogc3RyaW5nIHwgbnVsbCk6IGJvb2xlYW4ge1xuICB0cnkge1xuICAgIGNvbnN0IHNlY3JldCA9IHByb2Nlc3MuZW52LkNIQU5ORUxfU0VDUkVUIHx8IFwiXCI7XG4gICAgaWYgKCFzZWNyZXQgfHwgIXNpZ25hdHVyZSkgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IGhtYWMgPSBjcnlwdG8uY3JlYXRlSG1hYyhcInNoYTI1NlwiLCBzZWNyZXQpO1xuICAgIGhtYWMudXBkYXRlKHJhd0JvZHkpO1xuICAgIGNvbnN0IGRpZ2VzdCA9IGhtYWMuZGlnZXN0KFwiYmFzZTY0XCIpO1xuICAgIHJldHVybiBjcnlwdG8udGltaW5nU2FmZUVxdWFsKEJ1ZmZlci5mcm9tKGRpZ2VzdCksIEJ1ZmZlci5mcm9tKHNpZ25hdHVyZSkpO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxudHlwZSBMaW5lRXZlbnQgPSB7XG4gIHR5cGU6IHN0cmluZztcbiAgcmVwbHlUb2tlbj86IHN0cmluZztcbiAgc291cmNlPzogeyB1c2VySWQ/OiBzdHJpbmcgfTtcbiAgbWVzc2FnZT86IHsgdHlwZT86IHN0cmluZzsgdGV4dD86IHN0cmluZyB9O1xufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2lnbmF0dXJlID0gcmVxLmhlYWRlcnMuZ2V0KFwieC1saW5lLXNpZ25hdHVyZVwiKTtcbiAgICBjb25zdCByYXcgPSBhd2FpdCByZXEudGV4dCgpO1xuICAgIGNvbnN0IGRpc2FibGVWZXJpZnkgPSBTdHJpbmcocHJvY2Vzcy5lbnYuRElTQUJMRV9MSU5FX1NJR05BVFVSRV9WRVJJRlkgfHwgXCJcIikudG9Mb3dlckNhc2UoKSA9PT0gXCJ0cnVlXCI7XG4gICAgaWYgKCFkaXNhYmxlVmVyaWZ5ICYmICF2ZXJpZnlMaW5lU2lnbmF0dXJlKHJhdywgc2lnbmF0dXJlKSkge1xuICAgICAgdHJ5IHsgYWRkRXZlbnQoeyB0eXBlOiAnaHR0cCcsIG9rOiBmYWxzZSwgbWVzc2FnZTogJ1BPU1QgL2FwaS9saW5lLXdlYmhvb2sgNDAxJyB9KTsgfSBjYXRjaCB7fVxuICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeSh7IGVycm9yOiBcImludmFsaWQgc2lnbmF0dXJlXCIgfSksIHtcbiAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJhdykgYXMgeyBldmVudHM/OiBMaW5lRXZlbnRbXSB9O1xuICAgIGNvbnN0IGV2ZW50cyA9IEFycmF5LmlzQXJyYXkoYm9keT8uZXZlbnRzKSA/IGJvZHkuZXZlbnRzIDogW107XG5cbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBnZXRDbGllbnQoKTtcbiAgICB1cGRhdGVTdGF0cyh7IGxpbmVXZWJob29rQWN0aXZlOiB0cnVlIH0pO1xuICAgIGlmICghZ2xvYmFsVGhpcy5fX3VzZXJQcmVmcykgZ2xvYmFsVGhpcy5fX3VzZXJQcmVmcyA9IG5ldyBNYXAoKTtcbiAgICBjb25zdCBwcmVmcyA9IGdsb2JhbFRoaXMuX191c2VyUHJlZnM7XG5cbiAgICBmb3IgKGNvbnN0IGV2IG9mIGV2ZW50cykge1xuICAgICAgY29uc3QgdXNlcklkID0gZXY/LnNvdXJjZT8udXNlcklkIHx8IFwiXCI7XG4gICAgICBpZiAoZXY/LnR5cGUgPT09IFwibWVzc2FnZVwiICYmIGV2Py5tZXNzYWdlPy50eXBlID09PSBcInRleHRcIikge1xuICAgICAgICBsZXQgdGV4dCA9IGV2Lm1lc3NhZ2UudGV4dCB8fCBcIlwiO1xuICAgICAgICBjb25zdCBkZXN0ID0gdXNlcklkIHx8IChwcm9jZXNzLmVudi5ERVNUSU5BVElPTl9VU0VSX0lEIHx8IFwiXCIpO1xuICAgICAgICBsZXQgdCA9IHRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKHQuaW5jbHVkZXMoXCJsb2dpbiBkYlwiKSkge1xuICAgICAgICAgIGlmICh1c2VySWQpIHByZWZzIS5zZXQodXNlcklkLCB7IGtub3dsZWRnZVNvdXJjZTogXCJtc3NxbFwiIH0pO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBjbGllbnQuY2FsbFRvb2woe1xuICAgICAgICAgICAgICBuYW1lOiBcInB1c2hfdGV4dF9tZXNzYWdlXCIsXG4gICAgICAgICAgICAgIGFyZ3VtZW50czoge1xuICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiB7IHR5cGU6IFwidGV4dFwiLCB0ZXh0OiBcIuC5gOC4iuC4t+C5iOC4reC4oeC4leC5iOC4reC4kOC4suC4meC4guC5ieC4reC4oeC4ueC4pSAoTVNTUUwpIOC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC4luC4suC4oS/guJXguK3guJrguYHguKXguYnguKdcIiB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBjYXRjaCB7fVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0LmluY2x1ZGVzKFwibG9nb3V0IGRiXCIpKSB7XG4gICAgICAgICAgaWYgKHVzZXJJZCkgcHJlZnMhLnNldCh1c2VySWQsIHsga25vd2xlZGdlU291cmNlOiBcImZpbGVcIiB9KTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2xpZW50LmNhbGxUb29sKHtcbiAgICAgICAgICAgICAgbmFtZTogXCJwdXNoX3RleHRfbWVzc2FnZVwiLFxuICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogeyB0eXBlOiBcInRleHRcIiwgdGV4dDogXCLguKLguIHguYDguKXguLTguIHguYLguKvguKHguJTguJDguLLguJnguILguYnguK3guKHguLnguKUg4LmD4LiK4LmJ4LmE4Lif4Lil4LmM4LiE4Lin4Liy4Lih4Lij4Li54LmJ4LmB4LiX4LiZXCIgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gY2F0Y2gge31cbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHByZWYgPVxuICAgICAgICAgICh1c2VySWQgJiYgcHJlZnMhLmdldCh1c2VySWQpKSB8fFxuICAgICAgICAgICh7IGtub3dsZWRnZVNvdXJjZTogXCJmaWxlXCIgfSBhcyB7XG4gICAgICAgICAgICBrbm93bGVkZ2VTb3VyY2U6IFwiZmlsZVwiIHwgXCJtc3NxbFwiO1xuICAgICAgICAgICAgbGFzdFRhYmxlPzogc3RyaW5nO1xuICAgICAgICAgICAgbGFzdExpbWl0PzogbnVtYmVyO1xuICAgICAgICAgICAgbGFzdFJvd0NvdW50PzogbnVtYmVyO1xuICAgICAgICAgIH0pO1xuICAgICAgICBjb25zdCBrbm93bGVkZ2VTb3VyY2UgPSBwcmVmLmtub3dsZWRnZVNvdXJjZTtcblxuICAgICAgICAvLyBIZXVyaXN0aWM6IHJlbWVtYmVyIGV4cGxpY2l0IHRhYmxlIG1lbnRpb25zIGFuZCBzdXBwb3J0IHByb25vdW4gXCLguJXguLLguKPguLLguIfguJnguLXguYkvdGFibGUg4LiZ4Li14LmJL3RoaXMgdGFibGVcIlxuICAgICAgICBjb25zdCBleHBsaWNpdFRhYmxlTWF0Y2ggPSB0Lm1hdGNoKC8oPzp0YWJsZXzguIjguLLguIF84LmA4LiC4LmJ4Liy4LmE4LibfOC5hOC4m3xmcm9tKVxccysoW2EtejAtOV9cXC5dKykvaSk7XG4gICAgICAgIGlmIChleHBsaWNpdFRhYmxlTWF0Y2ggJiYgZXhwbGljaXRUYWJsZU1hdGNoWzFdICYmIHVzZXJJZCkge1xuICAgICAgICAgIGNvbnN0IHJhdyA9IGV4cGxpY2l0VGFibGVNYXRjaFsxXTtcbiAgICAgICAgICBjb25zdCBmdWxsID0gcmF3LmluY2x1ZGVzKFwiLlwiKSA/IHJhdyA6IGBkYm8uJHtyYXd9YDtcbiAgICAgICAgICBwcmVmcyEuc2V0KHVzZXJJZCwgeyAuLi5wcmVmLCBsYXN0VGFibGU6IGZ1bGwgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKC8o4LiV4Liy4Lij4Liy4LiH4LiZ4Li14LmJfHRhYmxlXFxzKuC4meC4teC5iXx0aGlzXFxzKnRhYmxlKS9pLnRlc3QodGV4dCkgJiYgcHJlZi5sYXN0VGFibGUpIHtcbiAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC/guJXguLLguKPguLLguIfguJnguLXguYl8dGFibGVcXHMq4LiZ4Li14LmJfHRoaXNcXHMqdGFibGUvZ2ksIHByZWYubGFzdFRhYmxlKTtcbiAgICAgICAgICB0ID0gdGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAoXG4gICAgICAgICAga25vd2xlZGdlU291cmNlID09PSBcIm1zc3FsXCIgJiZcbiAgICAgICAgICAvKOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4geC4teC5iOC4o+C4suC4ouC4geC4suC4o3zguKHguLXguIHguLXguYjguKPguLLguKLguIHguLLguKN8Y291bnRcXHMqKGFsbCk/KS9pLnRlc3QodGV4dClcbiAgICAgICAgKSB7XG4gICAgICAgICAgaWYgKHByZWYubGFzdFRhYmxlKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBxID0gYXdhaXQgY2xpZW50LmNhbGxUb29sKHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInF1ZXJ5X21zc3FsXCIsXG4gICAgICAgICAgICAgICAgYXJndW1lbnRzOiB7IHNxbDogYFNFTEVDVCBDT1VOVCgxKSBBUyB0b3RhbF9jb3VudCBGUk9NICR7cHJlZi5sYXN0VGFibGV9YCwgbGltaXQ6IDEgfSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UoKHEgYXMgYW55KS5jb250ZW50Py5bMF0/LnRleHQgfHwgXCJ7fVwiKTtcbiAgICAgICAgICAgICAgY29uc3Qgcm93czogYW55W10gPSBBcnJheS5pc0FycmF5KHBhcnNlZD8ucm93cykgPyBwYXJzZWQucm93cyA6IFtdO1xuICAgICAgICAgICAgICBjb25zdCBjbnQgPSByb3dzWzBdPy50b3RhbF9jb3VudCA/PyBwcmVmLmxhc3RSb3dDb3VudCA/PyAwO1xuICAgICAgICAgICAgICBjb25zdCBtc2cgPSBg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICR7Y250fSDguKPguLLguKLguIHguLLguKMgKOC4iOC4suC4gSAke3ByZWYubGFzdFRhYmxlfSlgO1xuICAgICAgICAgICAgICBhd2FpdCBjbGllbnQuY2FsbFRvb2woe1xuICAgICAgICAgICAgICAgIG5hbWU6IFwicHVzaF90ZXh0X21lc3NhZ2VcIixcbiAgICAgICAgICAgICAgICBhcmd1bWVudHM6IHsgdXNlcklkOiBkZXN0LCBtZXNzYWdlOiB7IHR5cGU6IFwidGV4dFwiLCB0ZXh0OiBtc2cgfSB9LFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgICAgLy8gaWdub3JlIGFuZCBmYWxsIHRocm91Z2hcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyAyKSBBc2sgd2hpY2ggdGFibGU/XG4gICAgICAgIGlmIChrbm93bGVkZ2VTb3VyY2UgPT09IFwibXNzcWxcIiAmJiAvKOC4iOC4suC4geC4leC4suC4o+C4suC4h+C5hOC4q+C4mXx3aGF0XFxzKnRhYmxlKS9pLnRlc3QodGV4dCkpIHtcbiAgICAgICAgICBjb25zdCBtc2cgPSBwcmVmLmxhc3RUYWJsZSA/IGDguIjguLLguIHguJXguLLguKPguLLguIcgJHtwcmVmLmxhc3RUYWJsZX1gIDogXCLguKLguLHguIfguYTguKHguYjguJfguKPguLLguJrguJXguLLguKPguLLguIcgKOC5guC4m+C4o+C4lOC4o+C4sOC4muC4uClcIjtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2xpZW50LmNhbGxUb29sKHtcbiAgICAgICAgICAgICAgbmFtZTogXCJwdXNoX3RleHRfbWVzc2FnZVwiLFxuICAgICAgICAgICAgICBhcmd1bWVudHM6IHsgdXNlcklkOiBkZXN0LCBtZXNzYWdlOiB7IHR5cGU6IFwidGV4dFwiLCB0ZXh0OiBtc2cgfSB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9IGNhdGNoIHt9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB1c2VyIGFza3MgZm9yIGFsbCB0YWJsZXMgc3VtbWFyeVxuICAgICAgICBpZiAoa25vd2xlZGdlU291cmNlID09PSBcIm1zc3FsXCIgJiYgLyjguYHguKrguJTguIfguILguYnguK3guKHguLnguKUuKuC4leC4suC4o+C4suC4hy4q4LiX4Lix4LmJ4LiH4Lir4Lih4LiUfOC5geC4quC4lOC4h+C4guC5ieC4reC4oeC4ueC4peC5geC4leC5iOC4peC4sFxccyrguJXguLLguKPguLLguId84LiX4Li44LiBXFxzKuC4leC4suC4o+C4suC4hykvaS50ZXN0KHRleHQpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFVzZSBNQ1AgdG9vbCBxdWVyeV9tc3NxbCB0byBmZXRjaCB0YWJsZSBsaXN0XG4gICAgICAgICAgICBjb25zdCBxID0gYXdhaXQgY2xpZW50LmNhbGxUb29sKHtcbiAgICAgICAgICAgICAgbmFtZTogXCJxdWVyeV9tc3NxbFwiLFxuICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICBzcWw6XG4gICAgICAgICAgICAgICAgICBcIlNFTEVDVCBUT1AgNTAgcy5uYW1lIEFTIHNjaGVtYV9uYW1lLCB0Lm5hbWUgQVMgdGFibGVfbmFtZSBGUk9NIHN5cy50YWJsZXMgdCBKT0lOIHN5cy5zY2hlbWFzIHMgT04gdC5zY2hlbWFfaWQgPSBzLnNjaGVtYV9pZCBXSEVSRSB0LmlzX21zX3NoaXBwZWQgPSAwIE9SREVSIEJZIHMubmFtZSwgdC5uYW1lXCIsXG4gICAgICAgICAgICAgICAgbGltaXQ6IDUwLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKChxIGFzIGFueSkuY29udGVudD8uWzBdPy50ZXh0IHx8IFwie31cIik7XG4gICAgICAgICAgICBjb25zdCByb3dzOiBhbnlbXSA9IEFycmF5LmlzQXJyYXkocGFyc2VkPy5yb3dzKSA/IHBhcnNlZC5yb3dzIDogW107XG4gICAgICAgICAgICBjb25zdCBvdXQgPSByb3dzXG4gICAgICAgICAgICAgIC5tYXAoKHI6IGFueSkgPT4gYC0gJHtyLnNjaGVtYV9uYW1lfS4ke3IudGFibGVfbmFtZX1gKVxuICAgICAgICAgICAgICAuc2xpY2UoMCwgNTApXG4gICAgICAgICAgICAgIC5qb2luKFwiXFxuXCIpO1xuICAgICAgICAgICAgY29uc3QgdGV4dE1zZyA9IG91dCB8fCBcIijguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIcpXCI7XG4gICAgICAgICAgICBhd2FpdCBjbGllbnQuY2FsbFRvb2woe1xuICAgICAgICAgICAgICBuYW1lOiBcInB1c2hfdGV4dF9tZXNzYWdlXCIsXG4gICAgICAgICAgICAgIGFyZ3VtZW50czogeyB1c2VySWQsIG1lc3NhZ2U6IHsgdHlwZTogXCJ0ZXh0XCIsIHRleHQ6IHRleHRNc2cgfSB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9IGNhdGNoIHt9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB1c2VyIHNheXMgXCLguYHguKrguJTguIfguKHguLIv4LmC4LiK4Lin4LmM4Lir4LiZ4LmI4Lit4LiiL+C5gOC4reC4suC4oeC4slwiIGFuZCB3ZSBoYXZlIGxhc3RUYWJsZSAoKyBvcHRpb25hbCBsYXN0TGltaXQpXG4gICAgICAgIGlmIChrbm93bGVkZ2VTb3VyY2UgPT09IFwibXNzcWxcIiAmJiAvKOC5geC4quC4lOC4h+C4oeC4snzguYLguIrguKfguYzguKvguJnguYjguK3guKJ84LmA4Lit4Liy4Lih4LiyKS9pLnRlc3QodGV4dCkgJiYgcHJlZi5sYXN0VGFibGUpIHtcbiAgICAgICAgICBjb25zdCBsaW0gPSBwcmVmLmxhc3RMaW1pdCAmJiBwcmVmLmxhc3RMaW1pdCA+IDAgPyBwcmVmLmxhc3RMaW1pdCA6IDEwO1xuICAgICAgICAgIHRleHQgPSBg4LmA4LiC4LmJ4Liy4LmE4LibICR7cHJlZi5sYXN0VGFibGV9IOC5geC4quC4lOC4hyR7bGltfSDguILguYnguK3guKHguLnguKVgO1xuICAgICAgICAgIHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiB1c2VyIHNheXMgXCLguYHguKrguJTguIcge059ICjguKPguLLguKLguIHguLLguKN84LmB4LiW4LinKVwiIGFuZCB3ZSBoYXZlIGxhc3RUYWJsZSwgcmV3cml0ZVxuICAgICAgICBjb25zdCBtU2hvd04gPSB0Lm1hdGNoKC/guYHguKrguJTguIcoPzrguILguYnguK3guKHguLnguKUpP1xccyooXFxkezEsNH0pXFxzKig/OuC4o+C4suC4ouC4geC4suC4o3zguYHguJbguKcpPy9pKTtcbiAgICAgICAgaWYgKGtub3dsZWRnZVNvdXJjZSA9PT0gXCJtc3NxbFwiICYmIG1TaG93TiAmJiBwcmVmLmxhc3RUYWJsZSkge1xuICAgICAgICAgIGNvbnN0IGxpbSA9IHBhcnNlSW50KG1TaG93TlsxXSwgMTApO1xuICAgICAgICAgIHRleHQgPSBg4LmA4LiC4LmJ4Liy4LmE4LibICR7cHJlZi5sYXN0VGFibGV9IOC5geC4quC4lOC4hyR7bGltfSDguILguYnguK3guKHguLnguKVgO1xuICAgICAgICAgIHByZWZzIS5zZXQodXNlcklkLCB7IC4uLnByZWYsIGxhc3RMaW1pdDogbGltIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRyeSBBSS1kcml2ZW4gU1FMIGZpcnN0IHdoZW4gdXNpbmcgREIga25vd2xlZGdlXG4gICAgICAgIGlmIChrbm93bGVkZ2VTb3VyY2UgPT09IFwibXNzcWxcIikge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBxID0gYXdhaXQgY2xpZW50LmNhbGxUb29sKHtcbiAgICAgICAgICAgICAgbmFtZTogXCJhaV9xdWVyeV9tc3NxbFwiLFxuICAgICAgICAgICAgICBhcmd1bWVudHM6IHtcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbjogdGV4dCxcbiAgICAgICAgICAgICAgICBtYXhSb3dzOiAxMCxcbiAgICAgICAgICAgICAgICBhbGxvd2VkVGFibGVzOiBwcmVmLmxhc3RUYWJsZSA/IFtwcmVmLmxhc3RUYWJsZV0gOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHJhdyA9IChxIGFzIGFueSk/LmNvbnRlbnQ/LlswXT8udGV4dCB8fCBcIlwiO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHJhdyA/IEpTT04ucGFyc2UocmF3KSA6IG51bGw7XG4gICAgICAgICAgICAgIGlmIChwYXlsb2FkICYmIEFycmF5LmlzQXJyYXkocGF5bG9hZC5yb3dzKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvd3M6IGFueVtdID0gcGF5bG9hZC5yb3dzIGFzIGFueVtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbHM6IHN0cmluZ1tdID0gQXJyYXkuaXNBcnJheShwYXlsb2FkLmNvbHVtbnMpXG4gICAgICAgICAgICAgICAgICA/IChwYXlsb2FkLmNvbHVtbnMgYXMgc3RyaW5nW10pXG4gICAgICAgICAgICAgICAgICA6IHJvd3NbMF1cbiAgICAgICAgICAgICAgICAgICAgPyBPYmplY3Qua2V5cyhyb3dzWzBdKVxuICAgICAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpZXdDb2xzID0gY29scy5zbGljZSgwLCAzKTtcbiAgICAgICAgICAgICAgICBjb25zdCBoZWFkID0gYOC4nOC4peC4peC4seC4nuC4mOC5jCAke01hdGgubWluKHJvd3MubGVuZ3RoLCAxMCl9IC8gJHtwYXlsb2FkLnJvd0NvdW50ID8/IHJvd3MubGVuZ3RofSDguYHguJbguKdgO1xuICAgICAgICAgICAgICAgIGNvbnN0IGJvZHkgPSByb3dzXG4gICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgMTApXG4gICAgICAgICAgICAgICAgICAubWFwKChyLCBpKSA9PiBgJHtpICsgMX0uICR7cHJldmlld0NvbHMubWFwKGMgPT4gYCR7Y306ICR7U3RyaW5nKHJbY10gPz8gXCJcIil9YCkuam9pbihcIiwgXCIpfWApXG4gICAgICAgICAgICAgICAgICAuam9pbihcIlxcblwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0eHQgPSBbaGVhZCwgYm9keV0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oXCJcXG5cIikuc2xpY2UoMCwgMjAwMCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50LmNhbGxUb29sKHtcbiAgICAgICAgICAgICAgICAgIG5hbWU6IFwicHVzaF90ZXh0X21lc3NhZ2VcIixcbiAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogeyB1c2VySWQ6IGRlc3QsIG1lc3NhZ2U6IHsgdHlwZTogXCJ0ZXh0XCIsIHRleHQ6IHR4dCB9IH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGV4dHJhY3QgdGFibGUgbmFtZSBmcm9tIFNRTCBhbmQgc3RvcmUgY29udGV4dFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBzcWw6IHN0cmluZyA9IFN0cmluZyhwYXlsb2FkLnNxbCB8fCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG1Gcm9tID0gc3FsLm1hdGNoKC9mcm9tXFxzKyhbYS16MC05X1xcLl0rKS9pKTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHRibCA9IG1Gcm9tICYmIG1Gcm9tWzFdID8gbUZyb21bMV0gOiBwcmVmLmxhc3RUYWJsZTtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1ByZWYgPSB7IC4uLnByZWYsIGxhc3RUYWJsZTogdGJsLCBsYXN0TGltaXQ6IDEwLCBsYXN0Um93Q291bnQ6IHBheWxvYWQucm93Q291bnQgPz8gcm93cy5sZW5ndGggfTtcbiAgICAgICAgICAgICAgICAgIGlmICh1c2VySWQpIHByZWZzIS5zZXQodXNlcklkLCBuZXdQcmVmKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIHt9XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgICAvLyBwYXJzaW5nIGZhaWxlZDsgZmFsbCBiYWNrIGJlbG93XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAvLyBhaV9xdWVyeV9tc3NxbCBmYWlsZWQ7IGZhbGwgYmFjayBiZWxvd1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFyZ3M6IGFueSA9IHtcbiAgICAgICAgICBpbnN0cnVjdGlvbjogdGV4dCxcbiAgICAgICAgICBtb2RlbDogXCJnZW1pbmktMi4wLWZsYXNoXCIsXG4gICAgICAgICAgbW9kZTogXCJhdXRvXCIsXG4gICAgICAgICAgdXNlcklkOiBkZXN0LFxuICAgICAgICAgIGtub3dsZWRnZVNvdXJjZSxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGtub3dsZWRnZVNvdXJjZSA9PT0gXCJmaWxlXCIpIHtcbiAgICAgICAgICBjb25zdCBkZWZhdWx0S25vd2xlZGdlID0gcHJvY2Vzcy5lbnYuREVGQVVMVF9LTk9XTEVER0VfRklMRSB8fCBcImRvY3MvZGF0YS1sZWFybmluZy9rbm93bGVkZ2UubWRcIjtcbiAgICAgICAgICBhcmdzLmZpbGVQYXRoID0gZGVmYXVsdEtub3dsZWRnZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgY2xpZW50LmNhbGxUb29sKHsgbmFtZTogXCJnZW1pbmlfY29tbWFuZFwiLCBhcmd1bWVudHM6IGFyZ3MgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBzd2FsbG93IHRvIG5vdCBicmVhayB3ZWJob29rIHBpcGVsaW5lXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0cnkgeyBhZGRFdmVudCh7IHR5cGU6ICdodHRwJywgb2s6IHRydWUsIG1lc3NhZ2U6ICdQT1NUIC9hcGkvbGluZS13ZWJob29rIDIwMCcgfSk7IH0gY2F0Y2gge31cbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHsgb2s6IHRydWUgfSksIHtcbiAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgdHJ5IHsgYWRkRXZlbnQoeyB0eXBlOiAnaHR0cCcsIG9rOiBmYWxzZSwgbWVzc2FnZTogJ1BPU1QgL2FwaS9saW5lLXdlYmhvb2sgNTAwJyB9KTsgfSBjYXRjaCB7fVxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogZT8ubWVzc2FnZSB8fCBTdHJpbmcoZSkgfSksIHtcbiAgICAgIHN0YXR1czogNTAwLFxuICAgICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxuICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsicnVudGltZSIsImR5bmFtaWMiLCJjcnlwdG8iLCJmcyIsInBhdGgiLCJDbGllbnQiLCJTdGRpb0NsaWVudFRyYW5zcG9ydCIsInVwZGF0ZVN0YXRzIiwiYWRkRXZlbnQiLCJsb2FkUGFyZW50RW52T25jZSIsImxvYWRlZEZsYWciLCJnbG9iYWxUaGlzIiwiX19wYXJlbnRFbnZMb2FkZWQiLCJwYXJlbnRFbnYiLCJyZXNvbHZlIiwicHJvY2VzcyIsImN3ZCIsImV4aXN0c1N5bmMiLCJ0ZXh0IiwicmVhZEZpbGVTeW5jIiwibGluZSIsInNwbGl0IiwidHJpbSIsInN0YXJ0c1dpdGgiLCJpZHgiLCJpbmRleE9mIiwia2V5Iiwic2xpY2UiLCJ2YWwiLCJlbmRzV2l0aCIsImVudiIsImdldENsaWVudCIsIl9fbWNwQ2xpZW50V2ViaG9vayIsInByb2plY3RSb290IiwidHJhbnNwb3J0IiwiY29tbWFuZCIsImFyZ3MiLCJjbGllbnQiLCJuYW1lIiwidmVyc2lvbiIsImNvbm5lY3QiLCJtY3BDb25uZWN0ZWQiLCJsaW5lV2ViaG9va0FjdGl2ZSIsInZlcmlmeUxpbmVTaWduYXR1cmUiLCJyYXdCb2R5Iiwic2lnbmF0dXJlIiwic2VjcmV0IiwiQ0hBTk5FTF9TRUNSRVQiLCJobWFjIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsInRpbWluZ1NhZmVFcXVhbCIsIkJ1ZmZlciIsImZyb20iLCJQT1NUIiwicmVxIiwiaGVhZGVycyIsImdldCIsInJhdyIsImRpc2FibGVWZXJpZnkiLCJTdHJpbmciLCJESVNBQkxFX0xJTkVfU0lHTkFUVVJFX1ZFUklGWSIsInRvTG93ZXJDYXNlIiwidHlwZSIsIm9rIiwibWVzc2FnZSIsIlJlc3BvbnNlIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yIiwic3RhdHVzIiwiYm9keSIsInBhcnNlIiwiZXZlbnRzIiwiQXJyYXkiLCJpc0FycmF5IiwiX191c2VyUHJlZnMiLCJNYXAiLCJwcmVmcyIsImV2IiwidXNlcklkIiwic291cmNlIiwiZGVzdCIsIkRFU1RJTkFUSU9OX1VTRVJfSUQiLCJ0IiwiaW5jbHVkZXMiLCJzZXQiLCJrbm93bGVkZ2VTb3VyY2UiLCJjYWxsVG9vbCIsImFyZ3VtZW50cyIsInByZWYiLCJleHBsaWNpdFRhYmxlTWF0Y2giLCJtYXRjaCIsImZ1bGwiLCJsYXN0VGFibGUiLCJ0ZXN0IiwicmVwbGFjZSIsInEiLCJzcWwiLCJsaW1pdCIsInBhcnNlZCIsImNvbnRlbnQiLCJyb3dzIiwiY250IiwidG90YWxfY291bnQiLCJsYXN0Um93Q291bnQiLCJtc2ciLCJvdXQiLCJtYXAiLCJyIiwic2NoZW1hX25hbWUiLCJ0YWJsZV9uYW1lIiwiam9pbiIsInRleHRNc2ciLCJsaW0iLCJsYXN0TGltaXQiLCJtU2hvd04iLCJwYXJzZUludCIsImluc3RydWN0aW9uIiwibWF4Um93cyIsImFsbG93ZWRUYWJsZXMiLCJ1bmRlZmluZWQiLCJwYXlsb2FkIiwiY29scyIsImNvbHVtbnMiLCJPYmplY3QiLCJrZXlzIiwicHJldmlld0NvbHMiLCJoZWFkIiwiTWF0aCIsIm1pbiIsImxlbmd0aCIsInJvd0NvdW50IiwiaSIsImMiLCJ0eHQiLCJmaWx0ZXIiLCJCb29sZWFuIiwibUZyb20iLCJ0YmwiLCJuZXdQcmVmIiwibW9kZWwiLCJtb2RlIiwiZGVmYXVsdEtub3dsZWRnZSIsIkRFRkFVTFRfS05PV0xFREdFX0ZJTEUiLCJmaWxlUGF0aCIsImUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/line-webhook/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/stats.ts":
/*!**********************!*\
  !*** ./lib/stats.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addEvent: () => (/* binding */ addEvent),\n/* harmony export */   countResultTokens: () => (/* binding */ countResultTokens),\n/* harmony export */   estimateTokens: () => (/* binding */ estimateTokens),\n/* harmony export */   getStats: () => (/* binding */ getStats),\n/* harmony export */   updateStats: () => (/* binding */ updateStats)\n/* harmony export */ });\nfunction getStats() {\n    if (!globalThis.__uiStats) {\n        globalThis.__uiStats = {\n            tokensUsed: 0,\n            inputTokens: 0,\n            outputTokens: 0,\n            calls: 0,\n            mcpConnected: false,\n            lineWebhookActive: false,\n            aiReady: !!process.env.GEMINI_API_KEY,\n            lastUpdated: Date.now(),\n            recentEvents: []\n        };\n    }\n    return globalThis.__uiStats;\n}\nfunction updateStats(patch) {\n    const s = getStats();\n    Object.assign(s, patch, {\n        lastUpdated: Date.now()\n    });\n}\n// Very rough token estimator; works reasonably across languages\nfunction estimateTokens(text) {\n    if (!text) return 0;\n    const len = text.length;\n    // Tune for CJK/Thai (no spaces) vs latin spacing\n    const divisor = /[\\u0E00-\\u0E7F\\u4E00-\\u9FFF]/.test(text) ? 2.8 : 3.8;\n    return Math.max(1, Math.ceil(len / divisor));\n}\nfunction countResultTokens(result) {\n    try {\n        let sum = 0;\n        const walk = (obj)=>{\n            if (!obj) return;\n            if (typeof obj === \"string\") {\n                sum += estimateTokens(obj);\n                return;\n            }\n            if (Array.isArray(obj)) {\n                obj.forEach(walk);\n                return;\n            }\n            if (typeof obj === \"object\") {\n                for (const k of Object.keys(obj)){\n                    const v = obj[k];\n                    // Prioritize typical text fields\n                    if (k === \"text\" || k === \"message\" || k === \"content\") walk(v);\n                    else if (typeof v === \"string\" || typeof v === \"object\") walk(v);\n                }\n            }\n        };\n        walk(result);\n        return sum;\n    } catch  {\n        return 0;\n    }\n}\nfunction addEvent(ev) {\n    const s = getStats();\n    if (!s.recentEvents) s.recentEvents = [];\n    s.recentEvents.push({\n        ts: ev.ts ?? Date.now(),\n        type: ev.type,\n        ok: ev.ok,\n        message: ev.message\n    });\n    if (s.recentEvents.length > 50) s.recentEvents = s.recentEvents.slice(-50);\n    s.lastUpdated = Date.now();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3RhdHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFrQk8sU0FBU0E7SUFDZCxJQUFJLENBQUNDLFdBQVdDLFNBQVMsRUFBRTtRQUN6QkQsV0FBV0MsU0FBUyxHQUFHO1lBQ3JCQyxZQUFZO1lBQ1pDLGFBQWE7WUFDYkMsY0FBYztZQUNkQyxPQUFPO1lBQ1BDLGNBQWM7WUFDZEMsbUJBQW1CO1lBQ25CQyxTQUFTLENBQUMsQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO1lBQ3JDQyxhQUFhQyxLQUFLQyxHQUFHO1lBQ3JCQyxjQUFjLEVBQUU7UUFDbEI7SUFDRjtJQUNBLE9BQU9mLFdBQVdDLFNBQVM7QUFDN0I7QUFFTyxTQUFTZSxZQUFZQyxLQUF1QjtJQUNqRCxNQUFNQyxJQUFJbkI7SUFDVm9CLE9BQU9DLE1BQU0sQ0FBQ0YsR0FBR0QsT0FBTztRQUFFTCxhQUFhQyxLQUFLQyxHQUFHO0lBQUc7QUFDcEQ7QUFFQSxnRUFBZ0U7QUFDekQsU0FBU08sZUFBZUMsSUFBWTtJQUN6QyxJQUFJLENBQUNBLE1BQU0sT0FBTztJQUNsQixNQUFNQyxNQUFNRCxLQUFLRSxNQUFNO0lBQ3ZCLGlEQUFpRDtJQUNqRCxNQUFNQyxVQUFVLCtCQUErQkMsSUFBSSxDQUFDSixRQUFRLE1BQU07SUFDbEUsT0FBT0ssS0FBS0MsR0FBRyxDQUFDLEdBQUdELEtBQUtFLElBQUksQ0FBQ04sTUFBTUU7QUFDckM7QUFFTyxTQUFTSyxrQkFBa0JDLE1BQVc7SUFDM0MsSUFBSTtRQUNGLElBQUlDLE1BQU07UUFDVixNQUFNQyxPQUFPLENBQUNDO1lBQ1osSUFBSSxDQUFDQSxLQUFLO1lBQ1YsSUFBSSxPQUFPQSxRQUFRLFVBQVU7Z0JBQUVGLE9BQU9YLGVBQWVhO2dCQUFNO1lBQVE7WUFDbkUsSUFBSUMsTUFBTUMsT0FBTyxDQUFDRixNQUFNO2dCQUFFQSxJQUFJRyxPQUFPLENBQUNKO2dCQUFPO1lBQVE7WUFDckQsSUFBSSxPQUFPQyxRQUFRLFVBQVU7Z0JBQzNCLEtBQUssTUFBTUksS0FBS25CLE9BQU9vQixJQUFJLENBQUNMLEtBQU07b0JBQ2hDLE1BQU1NLElBQUksR0FBWSxDQUFDRixFQUFFO29CQUN6QixpQ0FBaUM7b0JBQ2pDLElBQUlBLE1BQU0sVUFBVUEsTUFBTSxhQUFhQSxNQUFNLFdBQVdMLEtBQUtPO3lCQUN4RCxJQUFJLE9BQU9BLE1BQU0sWUFBWSxPQUFPQSxNQUFNLFVBQVVQLEtBQUtPO2dCQUNoRTtZQUNGO1FBQ0Y7UUFDQVAsS0FBS0Y7UUFDTCxPQUFPQztJQUNULEVBQUUsT0FBTTtRQUFFLE9BQU87SUFBRztBQUN0QjtBQUVPLFNBQVNTLFNBQVNDLEVBQStEO0lBQ3RGLE1BQU14QixJQUFJbkI7SUFDVixJQUFJLENBQUNtQixFQUFFSCxZQUFZLEVBQUVHLEVBQUVILFlBQVksR0FBRyxFQUFFO0lBQ3hDRyxFQUFFSCxZQUFZLENBQUM0QixJQUFJLENBQUM7UUFBRUMsSUFBSUYsR0FBR0UsRUFBRSxJQUFJL0IsS0FBS0MsR0FBRztRQUFJK0IsTUFBTUgsR0FBR0csSUFBSTtRQUFFQyxJQUFJSixHQUFHSSxFQUFFO1FBQUVDLFNBQVNMLEdBQUdLLE9BQU87SUFBQztJQUM3RixJQUFJN0IsRUFBRUgsWUFBWSxDQUFDUyxNQUFNLEdBQUcsSUFBSU4sRUFBRUgsWUFBWSxHQUFHRyxFQUFFSCxZQUFZLENBQUNpQyxLQUFLLENBQUMsQ0FBQztJQUN2RTlCLEVBQUVOLFdBQVcsR0FBR0MsS0FBS0MsR0FBRztBQUMxQiIsInNvdXJjZXMiOlsid2VicGFjazovL2xpbmUtYm90LW1jcC11aS8uL2xpYi9zdGF0cy50cz8yMmYxIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCB0eXBlIFVpU3RhdHMgPSB7XG4gIHRva2Vuc1VzZWQ6IG51bWJlcjtcbiAgaW5wdXRUb2tlbnM6IG51bWJlcjtcbiAgb3V0cHV0VG9rZW5zOiBudW1iZXI7XG4gIGNhbGxzOiBudW1iZXI7XG4gIGxhc3RNb2RlbD86IHN0cmluZztcbiAgbWNwQ29ubmVjdGVkOiBib29sZWFuO1xuICBsaW5lV2ViaG9va0FjdGl2ZTogYm9vbGVhbjtcbiAgYWlSZWFkeT86IGJvb2xlYW47XG4gIGxhc3RVcGRhdGVkOiBudW1iZXI7IC8vIGVwb2NoIG1zXG4gIHJlY2VudEV2ZW50cz86IEFycmF5PHsgdHM6IG51bWJlcjsgdHlwZTogc3RyaW5nOyBvazogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0+O1xufTtcblxuZGVjbGFyZSBnbG9iYWwge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdmFyXG4gIHZhciBfX3VpU3RhdHM6IFVpU3RhdHMgfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTdGF0cygpOiBVaVN0YXRzIHtcbiAgaWYgKCFnbG9iYWxUaGlzLl9fdWlTdGF0cykge1xuICAgIGdsb2JhbFRoaXMuX191aVN0YXRzID0ge1xuICAgICAgdG9rZW5zVXNlZDogMCxcbiAgICAgIGlucHV0VG9rZW5zOiAwLFxuICAgICAgb3V0cHV0VG9rZW5zOiAwLFxuICAgICAgY2FsbHM6IDAsXG4gICAgICBtY3BDb25uZWN0ZWQ6IGZhbHNlLFxuICAgICAgbGluZVdlYmhvb2tBY3RpdmU6IGZhbHNlLFxuICAgICAgYWlSZWFkeTogISFwcm9jZXNzLmVudi5HRU1JTklfQVBJX0tFWSxcbiAgICAgIGxhc3RVcGRhdGVkOiBEYXRlLm5vdygpLFxuICAgICAgcmVjZW50RXZlbnRzOiBbXSxcbiAgICB9O1xuICB9XG4gIHJldHVybiBnbG9iYWxUaGlzLl9fdWlTdGF0cyE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVTdGF0cyhwYXRjaDogUGFydGlhbDxVaVN0YXRzPikge1xuICBjb25zdCBzID0gZ2V0U3RhdHMoKTtcbiAgT2JqZWN0LmFzc2lnbihzLCBwYXRjaCwgeyBsYXN0VXBkYXRlZDogRGF0ZS5ub3coKSB9KTtcbn1cblxuLy8gVmVyeSByb3VnaCB0b2tlbiBlc3RpbWF0b3I7IHdvcmtzIHJlYXNvbmFibHkgYWNyb3NzIGxhbmd1YWdlc1xuZXhwb3J0IGZ1bmN0aW9uIGVzdGltYXRlVG9rZW5zKHRleHQ6IHN0cmluZyk6IG51bWJlciB7XG4gIGlmICghdGV4dCkgcmV0dXJuIDA7XG4gIGNvbnN0IGxlbiA9IHRleHQubGVuZ3RoO1xuICAvLyBUdW5lIGZvciBDSksvVGhhaSAobm8gc3BhY2VzKSB2cyBsYXRpbiBzcGFjaW5nXG4gIGNvbnN0IGRpdmlzb3IgPSAvW1xcdTBFMDAtXFx1MEU3RlxcdTRFMDAtXFx1OUZGRl0vLnRlc3QodGV4dCkgPyAyLjggOiAzLjg7XG4gIHJldHVybiBNYXRoLm1heCgxLCBNYXRoLmNlaWwobGVuIC8gZGl2aXNvcikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY291bnRSZXN1bHRUb2tlbnMocmVzdWx0OiBhbnkpOiBudW1iZXIge1xuICB0cnkge1xuICAgIGxldCBzdW0gPSAwO1xuICAgIGNvbnN0IHdhbGsgPSAob2JqOiBhbnkpID0+IHtcbiAgICAgIGlmICghb2JqKSByZXR1cm47XG4gICAgICBpZiAodHlwZW9mIG9iaiA9PT0gJ3N0cmluZycpIHsgc3VtICs9IGVzdGltYXRlVG9rZW5zKG9iaik7IHJldHVybjsgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkgeyBvYmouZm9yRWFjaCh3YWxrKTsgcmV0dXJuOyB9XG4gICAgICBpZiAodHlwZW9mIG9iaiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgZm9yIChjb25zdCBrIG9mIE9iamVjdC5rZXlzKG9iaikpIHtcbiAgICAgICAgICBjb25zdCB2ID0gKG9iaiBhcyBhbnkpW2tdO1xuICAgICAgICAgIC8vIFByaW9yaXRpemUgdHlwaWNhbCB0ZXh0IGZpZWxkc1xuICAgICAgICAgIGlmIChrID09PSAndGV4dCcgfHwgayA9PT0gJ21lc3NhZ2UnIHx8IGsgPT09ICdjb250ZW50Jykgd2Fsayh2KTtcbiAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgdiA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHYgPT09ICdvYmplY3QnKSB3YWxrKHYpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICB3YWxrKHJlc3VsdCk7XG4gICAgcmV0dXJuIHN1bTtcbiAgfSBjYXRjaCB7IHJldHVybiAwOyB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRFdmVudChldjogeyB0cz86IG51bWJlcjsgdHlwZTogc3RyaW5nOyBvazogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nIH0pIHtcbiAgY29uc3QgcyA9IGdldFN0YXRzKCk7XG4gIGlmICghcy5yZWNlbnRFdmVudHMpIHMucmVjZW50RXZlbnRzID0gW107XG4gIHMucmVjZW50RXZlbnRzLnB1c2goeyB0czogZXYudHMgPz8gRGF0ZS5ub3coKSwgdHlwZTogZXYudHlwZSwgb2s6IGV2Lm9rLCBtZXNzYWdlOiBldi5tZXNzYWdlIH0pO1xuICBpZiAocy5yZWNlbnRFdmVudHMubGVuZ3RoID4gNTApIHMucmVjZW50RXZlbnRzID0gcy5yZWNlbnRFdmVudHMuc2xpY2UoLTUwKTtcbiAgcy5sYXN0VXBkYXRlZCA9IERhdGUubm93KCk7XG59XG4iXSwibmFtZXMiOlsiZ2V0U3RhdHMiLCJnbG9iYWxUaGlzIiwiX191aVN0YXRzIiwidG9rZW5zVXNlZCIsImlucHV0VG9rZW5zIiwib3V0cHV0VG9rZW5zIiwiY2FsbHMiLCJtY3BDb25uZWN0ZWQiLCJsaW5lV2ViaG9va0FjdGl2ZSIsImFpUmVhZHkiLCJwcm9jZXNzIiwiZW52IiwiR0VNSU5JX0FQSV9LRVkiLCJsYXN0VXBkYXRlZCIsIkRhdGUiLCJub3ciLCJyZWNlbnRFdmVudHMiLCJ1cGRhdGVTdGF0cyIsInBhdGNoIiwicyIsIk9iamVjdCIsImFzc2lnbiIsImVzdGltYXRlVG9rZW5zIiwidGV4dCIsImxlbiIsImxlbmd0aCIsImRpdmlzb3IiLCJ0ZXN0IiwiTWF0aCIsIm1heCIsImNlaWwiLCJjb3VudFJlc3VsdFRva2VucyIsInJlc3VsdCIsInN1bSIsIndhbGsiLCJvYmoiLCJBcnJheSIsImlzQXJyYXkiLCJmb3JFYWNoIiwiayIsImtleXMiLCJ2IiwiYWRkRXZlbnQiLCJldiIsInB1c2giLCJ0cyIsInR5cGUiLCJvayIsIm1lc3NhZ2UiLCJzbGljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/stats.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/ajv","vendor-chunks/zod","vendor-chunks/@modelcontextprotocol","vendor-chunks/uri-js","vendor-chunks/cross-spawn","vendor-chunks/which","vendor-chunks/isexe","vendor-chunks/json-schema-traverse","vendor-chunks/fast-json-stable-stringify","vendor-chunks/fast-deep-equal","vendor-chunks/path-key","vendor-chunks/shebang-command","vendor-chunks/shebang-regex"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fline-webhook%2Froute&page=%2Fapi%2Fline-webhook%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fline-webhook%2Froute.ts&appDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cfame%5Cnon-project%5Cline-bot-mcp-server%5Cui-next&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();